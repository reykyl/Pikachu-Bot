//Â© cÃ³digo creado por Deylin 
//https://github.com/Deylin-eliac 
//â¤  no quites creditos 

import { WAMessageStubType } from '@whiskeysockets/baileys'

const paises = {
  "1": "ğŸ‡ºğŸ‡¸ Estados Unidos", "34": "ğŸ‡ªğŸ‡¸ EspaÃ±a", "52": "ğŸ‡²ğŸ‡½ MÃ©xico", "54": "ğŸ‡¦ğŸ‡· Argentina",
  "55": "ğŸ‡§ğŸ‡· Brasil", "56": "ğŸ‡¨ğŸ‡± Chile", "57": "ğŸ‡¨ğŸ‡´ Colombia", "58": "ğŸ‡»ğŸ‡ª Venezuela",
  "591": "ğŸ‡§ğŸ‡´ Bolivia", "593": "ğŸ‡ªğŸ‡¨ Ecuador", "595": "ğŸ‡µğŸ‡¾ Paraguay", "598": "ğŸ‡ºğŸ‡¾ Uruguay",
  "502": "ğŸ‡¬ğŸ‡¹ Guatemala", "503": "ğŸ‡¸ğŸ‡» El Salvador", "504": "ğŸ‡­ğŸ‡³ Honduras", "505": "ğŸ‡³ğŸ‡® Nicaragua",
  "506": "ğŸ‡¨ğŸ‡· Costa Rica", "507": "ğŸ‡µğŸ‡¦ PanamÃ¡", "51": "ğŸ‡µğŸ‡ª PerÃº", "53": "ğŸ‡¨ğŸ‡º Cuba", "91": "ğŸ‡®ğŸ‡³ India"
};

function obtenerPais(numero) {
  let num = numero.replace("@s.whatsapp.net", "");
  let codigo = Object.keys(paises).find(pref => num.startsWith(pref));
  return paises[codigo] || "ğŸŒ Desconocido";
}

export async function before(m, { conn, participants, groupMetadata }) {
  if (!m.messageStubType || !m.isGroup) return;
  if (m.chat === "120363402481697721@g.us") return;

  let who = m.messageStubParameters[0];
  let taguser = `@${who.split("@")[0]}`;
  let chat = global.db.data.chats[m.chat];
  let totalMembers = participants.length;
  let date = new Date().toLocaleString("es-ES", { timeZone: "America/Mexico_City" });

  let pais = obtenerPais(who);
  let ppUser = 'https://raw.githubusercontent.com/Deylin-Eliac/Pikachu-Bot/refs/heads/main/src/IMG-20250613-WA0194.jpg';

  try {
    ppUser = await conn.profilePictureUrl(who, 'image');
  } catch (e) {
    
  }

  let frasesBienvenida = [
    "Â¡Pika Pika! Bienvenido al grupo.",
    "Â¡Un rayo de energÃ­a ha llegado al grupo!",
    "Pikachu dice que este grupo ahora es 100% mÃ¡s elÃ©ctrico âš¡",
    "Â¡Esperamos que la pases genial, entrenador!",
    "Bienvenido al equipo, Â¡que empiece la aventura PokÃ©mon!"
  ];
  let frasesDespedida = [
    "Pikachu te dice adiÃ³s con una descarga de cariÃ±o.",
    "Otro entrenador deja el grupo... Â¡Buena suerte!",
    "Â¡Hasta la prÃ³xima, no olvides tus PokÃ©balls!",
    "El grupo se queda con menos voltaje âš¡",
    "Pikachu te extraÃ±arÃ¡ ğŸ¥º"
  ];

  let fraseRandomBienvenida = frasesBienvenida[Math.floor(Math.random() * frasesBienvenida.length)];
  let fraseRandomDespedida = frasesDespedida[Math.floor(Math.random() * frasesDespedida.length)];

  if (chat.welcome) {
    if (m.messageStubType === WAMessageStubType.GROUP_PARTICIPANT_ADD) {
      let bienvenida = `
*âš¡â”€ã€ ğ‘©ğ‘°ğ‘¬ğ‘µğ‘½ğ‘¬ğ‘µğ‘°ğ‘«ğ‘¶/ğ‘¨ ã€â”€ğŸ§ƒ*
ğŸ‘¤ *Usuario:* ${taguser}
ğŸŒ *PaÃ­s:* ${pais}
ğŸ’¬ *Grupo:* *${groupMetadata.subject}*
ğŸ‘¥ *Miembros:* *${totalMembers + 1}*
ğŸ“… *Fecha:* *${date}*
âš¡ *Mensaje:* ${fraseRandomBienvenida}
      `.trim();

      await conn.sendMessage(m.chat, {
        image: { url: ppUser },
        caption: bienvenida,
        mentions: [who]
      });
    }

    if (
      m.messageStubType === WAMessageStubType.GROUP_PARTICIPANT_LEAVE ||
      m.messageStubType === WAMessageStubType.GROUP_PARTICIPANT_REMOVE
    ) {
      let despedida = `
*âš¡â”€â”€ã€ ğ‘«ğ‘¬ğ‘ºğ‘·ğ‘¬ğ‘«ğ‘°ğ‘«ğ‘¨ ğ‘«ğ‘¬/? ã€â”€â”€ğŸ§ƒ*
ğŸ‘¤ *Usuario:* ${taguser}
ğŸŒ *PaÃ­s:* ${pais}
ğŸ’¬ *Grupo:* *${groupMetadata.subject}*
ğŸ‘¥ *Miembros:* *${totalMembers - 1}*
ğŸ“… *Fecha:* *${date}*
âš¡ *Mensaje:* ${fraseRandomDespedida}
      `.trim();

      await conn.sendMessage(m.chat, {
        image: { url: ppUser },
        caption: despedida,
        mentions: [who]
      });
    }
  }
}